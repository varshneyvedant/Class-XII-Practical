{% extends "layout.html" %}
{% block content %}
<div class="content-block">
    {# The title is hardcoded for simplicity. #}
    <h2 class="subtitle">Interschool Competition Leaderboard</h2>
    
    {% if last_updated %}
    <div class="last-updated">
        {# The date formatting is simplified. #}
        Last Updated: {{ last_updated }}
    </div>
    {% endif %}

    {# This button demonstrates the CSV export feature, which is a key part of the "File Handling" topic. #}
    <div class="export-button-container">
        <a href="{{ url_for('export_leaderboard_csv') }}" class="button-link">Export as CSV</a>
    </div>

    <h3 class="section-title">Overall Rankings</h3>
    {% if schools %}
        <table id="leaderboard-table">
            <thead>
                <tr>
                    <th>Rank</th>
                    <th>School Name</th>
                    <th>Total Points</th>
                    <th>1st</th>
                    <th>2nd</th>
                    <th>3rd</th>
                    <th class="actions-column">Details</th>
                </tr>
            </thead>
            <tbody>
                {# This loop demonstrates iterating through data in a template. #}
                {% for school in schools %}
                {# We add a class for the top 3 ranks to apply special styling (gold, silver, bronze). #}
                <tr class="{% if school.rank <= 3 %}rank-{{ school.rank }}{% endif %}">
                    <td data-label="Rank">{{ school.rank }} {% if school.rank <= 3 %}🏆{% endif %}</td>
                    <td data-label="School Name">{{ school.school }}</td>
                    <td data-label="Total Points">{{ school.total_points }}</td>
                    <td data-label="1st">{{ school.first_places }}</td>
                    <td data-label="2nd">{{ school.second_places }}</td>
                    <td data-label="3rd">{{ school.third_places }}</td>
                    <td data-label="Details" class="actions-column">
                        <a href="{{ url_for('school_details', school_name=school.school) }}" class="button-link-details">View</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No results have been submitted yet. The leaderboard will update as results come in.</p>
    {% endif %}

    <div class="tie-breaker-info">
        <p><strong>Note on Tie-Breakers:</strong> Ranks are determined by total points. Ties are broken by the number of 1st, then 2nd, then 3rd place finishes.</p>
    </div>

    {% if all_results %}
    <div class="recent-achievements">
        <h3 class="section-title">All Event Results</h3>
        <div class="achievements-grid">
        {% for result in all_results %}
            <div class="achievement-card">
                <h4>{{ result.name }}</h4>
                <p>🥇 <strong>1st:</strong> {{ result.first_place_school }}</p>
                <p>🥈 <strong>2nd:</strong> {{ result.second_place_school }}</p>
                <p>🥉 <strong>3rd:</strong> {{ result.third_place_school }}</p>
            </div>
        {% endfor %}
        </div>
    </div>
    {% endif %}
</div>

{% endblock %}